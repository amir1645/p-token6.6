<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PToken DApp</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">
        <i class="fas fa-coins logo-icon"></i>
        <h1 class="title">PToken DApp</h1>
      </div>
      <div class="language-select">
        <select id="language" onchange="changeLanguage()">
          <option value="fa">فارسی</option>
          <option value="en">English</option>
        </select>
      </div>
    </div>

    <div class="tabs">
      <div class="tab active" onclick="switchTab('wallet')">کیف پول</div>
      <div class="tab" onclick="switchTab('user')">اطلاعات کاربر</div>
      <div class="tab" onclick="switchTab('tree')">ساختار درختی</div>
      <div class="tab" onclick="switchTab('miner')">ماینر</div>
      <div class="tab" onclick="switchTab('withdraw')">برداشت</div>
    </div>

    <!-- تب کیف پول -->
    <div id="wallet-tab" class="tab-content active">
      <div class="section wallet-section">
        <h2 class="section-title"><i class="fas fa-wallet"></i> اتصال کیف پول</h2>
        <button id="connect-btn" onclick="connectWallet()" class="button pulse">
          <i class="fas fa-plug"></i> اتصال به MetaMask
        </button>
        <button id="disconnect-btn" onclick="disconnectWallet()" class="button button-secondary" style="display: none;">
          <i class="fas fa-power-off"></i> قطع اتصال
        </button>
        <p id="account" class="account"></p>
      </div>
    </div>

    <!-- تب اطلاعات کاربر -->
    <div id="user-tab" class="tab-content">
      <div class="section">
        <h2 class="section-title"><i class="fas fa-user"></i> ثبت‌نام</h2>
        <div class="input-group">
          <input id="upline-address" type="text" placeholder="شناسه آپلاین (عدد)" class="input">
          <div class="radio-group">
            <label>
              <input type="radio" name="place" value="left" checked> 
              <span>سمت چپ</span>
            </label>
            <label>
              <input type="radio" name="place" value="right"> 
              <span>سمت راست</span>
            </label>
          </div>
          <button onclick="register()" class="button button-success">
            <i class="fas fa-user-plus"></i> ثبت‌نام (350 MATIC)
          </button>
        </div>
      </div>

      <div class="section">
        <h2 class="section-title"><i class="fas fa-info-circle"></i> اطلاعات کاربر</h2>
        <div class="info-grid">
          <div class="info-card">
            <div class="label">شناسه کاربر</div>
            <div class="value" id="user-id">-</div>
          </div>
          <div class="info-card">
            <div class="label">آپلاین</div>
            <div class="value" id="user-upline">-</div>
          </div>
          <div class="info-card">
            <div class="label">تعداد سمت چپ</div>
            <div class="value" id="left-count">0</div>
          </div>
          <div class="info-card">
            <div class="label">تعداد سمت راست</div>
            <div class="value" id="right-count">0</div>
          </div>
          <div class="info-card">
            <div class="label">تعادل خورده</div>
            <div class="value" id="balance-count">0</div>
          </div>
          <div class="info-card">
            <div class="label">تعادل ذخیره شده</div>
            <div class="value" id="saved-balance-count">0</div>
          </div>
        </div>
      </div>
    </div>

    <!-- تب ساختار درختی -->
    <div id="tree-tab" class="tab-content">
      <div class="section">
        <h2 class="section-title"><i class="fas fa-sitemap"></i> ساختار درختی</h2>
        <div class="tree-container">
          <div id="tree" class="binary-tree">
            <p>لطفاً ابتدا به کیف پول متصل شوید</p>
          </div>
        </div>
      </div>
    </div>

    <!-- تب ماینر -->
    <div id="miner-tab" class="tab-content">
      <div class="section miner-section">
        <h2 class="section-title"><i class="fas fa-hard-hat"></i> وضعیت ماینر</h2>
        
        <div class="miner-status">
          <div>
            <div class="label">وضعیت</div>
            <div class="value" id="miner-status">غیرفعال</div>
          </div>
          
          <div class="miner-progress">
            <div class="label">پیشرفت پرداخت</div>
            <div class="progress-bar">
              <div class="progress-fill" id="miner-progress" style="width: 0%"></div>
            </div>
            <div class="value" id="miner-percentage">0%</div>
          </div>
          
          <button onclick="contributeToMiner()" class="button">
            <i class="fas fa-donate"></i> مشارکت در ماینر (0.1 MATIC)
          </button>
        </div>
        
        <div class="miner-stats">
          <div class="stat-card">
            <div class="stat-label">کاربران واجد شرایط</div>
            <div class="stat-value" id="eligible-users">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">تعداد ماینرها</div>
            <div class="stat-value" id="miner-count">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">پاداش کل ماینر</div>
            <div class="stat-value" id="total-miner-rewards">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">موجودی استخر</div>
            <div class="stat-value" id="miner-pool-balance">0</div>
          </div>
        </div>
        
        <div class="input-group" style="margin-top: 20px;">
          <button onclick="buyMinerTokens()" class="button">
            <i class="fas fa-shopping-cart"></i> خرید توکن ماینر
          </button>
          <button onclick="distributeMinerTokens()" class="button button-secondary">
            <i class="fas fa-share-alt"></i> توزیع توکن ماینر
          </button>
        </div>
      </div>
    </div>

    <!-- تب برداشت -->
    <div id="withdraw-tab" class="tab-content">
      <div class="section">
        <h2 class="section-title"><i class="fas fa-money-bill-wave"></i> برداشت وجوه</h2>
        
        <div class="withdraw-section">
          <div class="withdraw-card">
            <div class="label">موجودی قابل برداشت از استخر</div>
            <div class="amount" id="pool-balance">0 MATIC</div>
            <button onclick="withdrawPool()" class="button">
              <i class="fas fa-wallet"></i> برداشت از استخر
            </button>
          </div>
          
          <div class="withdraw-card">
            <div class="label">موجودی ویژه قابل برداشت</div>
            <div class="amount" id="special-balance">0 MATIC</div>
            <button onclick="withdrawSpecials()" class="button">
              <i class="fas fa-gem"></i> برداشت ویژه
            </button>
          </div>
        </div>

        <div class="section" style="margin-top: 20px;">
          <h3 class="section-title"><i class="fas fa-hand-holding-usd"></i> برداشت دستی</h3>
          <div class="input-group">
            <input type="text" id="manual-withdraw-amount" placeholder="مقدار (MATIC)" class="input">
            <select id="manual-withdraw-type" class="input">
              <option value="pool">از استخر</option>
              <option value="special">ویژه</option>
            </select>
            <button onclick="manualWithdraw()" class="button button-secondary">
              <i class="fas fa-hand-holding-usd"></i> برداشت دستی
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="message" class="message"></div>
  </div>

  <script src="app.js"></script>
</body>
</html>